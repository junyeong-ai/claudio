# slack-feedback-handler

ì‚¬ìš©ìì˜ í”¼ë“œë°± ë¦¬ì•¡ì…˜ì„ ìˆ˜ì§‘í•˜ì—¬ AI ì‘ë‹µ í’ˆì§ˆì„ ì¸¡ì •í•˜ëŠ” ì›Œí¬í”Œë¡œìš°.

---

## ê°œìš”

| í•­ëª© | ê°’ |
|------|-----|
| **íŠ¸ë¦¬ê±°** | Webhook (`/webhook/slack-feedback`) |
| **ì†ŒìŠ¤ ì´ë²¤íŠ¸** | Slack `reaction_added` (í”¼ë“œë°± ë¦¬ì•¡ì…˜ë§Œ) |
| **ì£¼ìš” ê¸°ëŠ¥** | ì‘ë‹µ í’ˆì§ˆ ì¸¡ì •, í”¼ë“œë°± ì €ì¥, í†µê³„ ì§‘ê³„ |

---

## í”¼ë“œë°± ì‹œìŠ¤í…œ

### ë¦¬ì•¡ì…˜ ë§¤í•‘

| ë¦¬ì•¡ì…˜ | ê°’ | ì˜ë¯¸ |
|--------|-----|------|
| :thumbsup: `+1` | `+1` | ê¸ì •ì  (ìœ ìš©í•œ ì‘ë‹µ) |
| :thumbsdown: `-1` | `-1` | ë¶€ì •ì  (ë¶€ì •í™•/ë¶ˆì¶©ë¶„) |

### í”¼ë“œë°± ë£¨í”„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        í”¼ë“œë°± ìˆ˜ì§‘ ì‚¬ì´í´                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  AI ì‘ë‹µ ìƒì„±           ë¦¬ì•¡ì…˜ ì¶”ê°€            í”¼ë“œë°± ìˆ˜ì§‘
       â”‚                     â”‚                     â”‚
       â–¼                     â–¼                     â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Reply   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ğŸ‘ ğŸ‘ ì¶”ê°€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Record  â”‚
  â”‚         â”‚          â”‚ (ìë™)   â”‚          â”‚Feedback â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                                 â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                      Dashboard ë¶„ì„                          â”‚
  â”‚                                                              â”‚
  â”‚  â€¢ ì—ì´ì „íŠ¸ë³„ ë§Œì¡±ë„                                          â”‚
  â”‚  â€¢ ë¶€ì • í”¼ë“œë°± ì‚¬ë¡€ ë¶„ì„                                      â”‚
  â”‚  â€¢ ì‹œê°„ëŒ€ë³„ í’ˆì§ˆ ì¶”ì´                                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        slack-feedback-handler                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Webhook           Filter Feedback        Lookup Execution
    â”‚                     â”‚                      â”‚
    â–¼                     â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Webhookâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Filter  â”‚â”€â”€(pass)â”€â”€â–ºâ”‚   Lookup    â”‚
â”‚       â”‚            â”‚Feedback â”‚           â”‚  Execution  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                       â”‚
                     (not match)                  â–¼
                          â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â–¼               â”‚   Record    â”‚
                       [Stop]             â”‚  Feedback   â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë…¸ë“œ ìƒì„¸

### 1. Webhook

**ì…ë ¥**:
```json
{
  "reaction": "thumbsup",
  "user": "U0123456789",
  "item": {
    "channel": "C0123456789",
    "ts": "1234567890.123456"
  },
  "event_ts": "1234567891.000000"
}
```

### 2. Filter Feedback

í”¼ë“œë°± ë¦¬ì•¡ì…˜ë§Œ í†µê³¼:

```javascript
const feedbackReactions = ['thumbsup', '+1', 'thumbsdown', '-1'];
const reaction = $json.body.reaction;

if (!feedbackReactions.includes(reaction)) {
  return []; // ë‹¤ë¥¸ ë¦¬ì•¡ì…˜ì€ slack-reaction-handlerë¡œ
}

const value = ['thumbsup', '+1'].includes(reaction) ? 1 : -1;
return { ...body, feedback_value: value };
```

### 3. Lookup Execution

ë©”ì‹œì§€ tsë¡œ ì‹¤í–‰ ì •ë³´ ì¡°íšŒ:

```
GET {N8N_API_URL}/v1/executions/lookup?channel={channel}&ts={ts}
```

**ì‘ë‹µ**:
```json
{
  "id": "exec_abc123",
  "project": "default",
  "agent": "General",
  "user_message": "Pythonìœ¼ë¡œ ì •ë ¬ ì•Œê³ ë¦¬ì¦˜ ì„¤ëª…í•´ì¤˜",
  "response": "ì •ë ¬ ì•Œê³ ë¦¬ì¦˜ì—ëŠ” ì—¬ëŸ¬ ì¢…ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤...",
  "created_at": 1234567890
}
```

### 4. Record Feedback

í”¼ë“œë°± ì €ì¥:

```
POST {N8N_API_URL}/v1/executions/{id}/reactions
```

**ìš”ì²­**:
```json
{
  "reaction": "thumbsup",
  "user_id": "U0123456789",
  "category": "feedback"
}
```

**ë‚´ë¶€ ì²˜ë¦¬**:
```sql
-- reactions í…Œì´ë¸”ì— ì €ì¥
INSERT INTO reactions (execution_id, reaction, user_id, category, created_at)
VALUES ('exec_abc123', 'thumbsup', 'U0123456789', 'feedback', 1234567891);

-- í”¼ë“œë°± ì ìˆ˜ ì§‘ê³„ (view ë˜ëŠ” ì¿¼ë¦¬ ì‹œ ê³„ì‚°)
-- positive: COUNT(*) WHERE reaction IN ('thumbsup', '+1')
-- negative: COUNT(*) WHERE reaction IN ('thumbsdown', '-1')
```

---

## ëŒ€ì‹œë³´ë“œ í™œìš©

### Feedback í˜ì´ì§€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Feedback Overview                              Last 7 days â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ‘ Positive: 142 (78%)    ğŸ‘ Negative: 40 (22%)           â”‚
â”‚                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                             â”‚
â”‚  Agent Performance                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ MR Reviewer      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  89%            â”‚   â”‚
â”‚  â”‚ General          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  72%            â”‚   â”‚
â”‚  â”‚ Incident Analyzerâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  65%            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë¶€ì • í”¼ë“œë°± ë¶„ì„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Negative Feedback Cases                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  âš ï¸ exec_abc123 | General | 2 hours ago                    â”‚
â”‚  User: "TypeScript íƒ€ì… ì—ëŸ¬ í•´ê²°í•´ì¤˜"                       â”‚
â”‚  Response: "JavaScriptì—ì„œëŠ”..."  â† ì–¸ì–´ í˜¼ë™               â”‚
â”‚                                                             â”‚
â”‚  âš ï¸ exec_def456 | MR Reviewer | 5 hours ago                â”‚
â”‚  User: "!789 ë¦¬ë·°í•´ì¤˜"                                      â”‚
â”‚  Response: "MRì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"  â† ì ‘ê·¼ ê¶Œí•œ ë¬¸ì œ         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì„¤ì •

### í™˜ê²½ë³€ìˆ˜ (n8n)

| ë³€ìˆ˜ | ì„¤ëª… |
|------|------|
| `N8N_API_URL` | claudio-api URL |

### í”¼ë“œë°± ë¦¬ì•¡ì…˜ ìë™ ì¶”ê°€

`slack-mention-handler`ì—ì„œ ì‘ë‹µ í›„ ìë™ ì¶”ê°€:

```javascript
// Reply í›„ ë¦¬ì•¡ì…˜ ì¶”ê°€
const reactions = ['thumbsup', 'thumbsdown'];
for (const emoji of reactions) {
  await slack.reactions.add({
    channel: channel,
    timestamp: response_ts,
    name: emoji
  });
}
```

---

## API

### í”¼ë“œë°± í†µê³„ ì¡°íšŒ

```bash
# ì „ì²´ í†µê³„
curl http://localhost:17280/v1/stats

# ì‘ë‹µ ì˜ˆì‹œ
{
  "total_requests": 500,
  "positive_feedback": 142,
  "negative_feedback": 40,
  "feedback_rate": 0.364
}
```

### ì‹¤í–‰ë³„ í”¼ë“œë°± ì¡°íšŒ

```bash
curl http://localhost:17280/v1/executions/exec_abc123

# ì‘ë‹µì— í¬í•¨
{
  "id": "exec_abc123",
  "feedback": 1,  // 1: positive, -1: negative, null: none
  ...
}
```

---

## í”¼ë“œë°± ê¸°ë°˜ ê°œì„ 

### 1. ì—ì´ì „íŠ¸ instruction ê°œì„ 

ë¶€ì • í”¼ë“œë°±ì´ ë§ì€ íŒ¨í„´ ë¶„ì„ â†’ instruction ìˆ˜ì •:

```json
{
  "instruction": "... ì‚¬ìš©ìê°€ ì–¸ì–´ë¥¼ ëª…ì‹œí•˜ì§€ ì•Šìœ¼ë©´ ë°˜ë“œì‹œ í™•ì¸í•˜ì„¸ìš” ..."
}
```

### 2. examples ë³´ê°•

ì˜ëª» ë¼ìš°íŒ…ëœ ì¼€ì´ìŠ¤ â†’ examples ì¶”ê°€:

```json
{
  "examples": [
    "TypeScript ì—ëŸ¬ í•´ê²°",   // ì¶”ê°€
    "TS íƒ€ì… ë¬¸ì œ",          // ì¶”ê°€
    ...
  ]
}
```

### 3. ëª¨ë¸ ì—…ê·¸ë ˆì´ë“œ

ë³µì¡í•œ ì¿¼ë¦¬ì—ì„œ ë¶€ì • í”¼ë“œë°± â†’ ëª¨ë¸ ë³€ê²½:

```json
{
  "model": "opus"  // haiku â†’ opus
}
```

---

## ì—°ê´€ ì›Œí¬í”Œë¡œìš°

- [slack-mention-handler](slack-mention-handler.md) â€” ì‘ë‹µ ìƒì„± + í”¼ë“œë°± ë¦¬ì•¡ì…˜ ì¶”ê°€
- [slack-reaction-handler](slack-reaction-handler.md) â€” ë¹„í”¼ë“œë°± ë¦¬ì•¡ì…˜ ì²˜ë¦¬
