# user-context-handler

ì‚¬ìš©ìë³„ ì»¨í…ìŠ¤íŠ¸ë¥¼ ê´€ë¦¬í•˜ì—¬ ê°œì¸í™”ëœ AI ì‘ë‹µì„ ì œê³µí•˜ëŠ” ì›Œí¬í”Œë¡œìš°.

---

## ê°œìš”

| í•­ëª© | ê°’ |
|------|-----|
| **íŠ¸ë¦¬ê±°** | Webhook (ë‚´ë¶€ í˜¸ì¶œ) |
| **ì£¼ìš” ê¸°ëŠ¥** | ì‚¬ìš©ì ê·œì¹™ ê´€ë¦¬, ëŒ€í™” íˆìŠ¤í† ë¦¬ ìš”ì•½, ê°œì¸í™” |

---

## ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ êµ¬ì¡°

```json
{
  "user_id": "U0123456789",
  "rules": [
    "í•­ìƒ í•œêµ­ì–´ë¡œ ë‹µë³€í•´ì¤˜",
    "ì½”ë“œ ì˜ˆì‹œëŠ” TypeScriptë¡œ ì‘ì„±í•´ì¤˜",
    "ì„¤ëª…ì€ ê°„ê²°í•˜ê²Œ í•´ì¤˜"
  ],
  "summary": "Backend ê°œë°œì. Spring Boot, Kotlin ì „ë¬¸. ìµœê·¼ ê²°ì œ ì‹œìŠ¤í…œ ë¦¬íŒ©í† ë§ ì§„í–‰ ì¤‘.",
  "last_summarized_at": 1234567890,
  "recent_conversations": [
    {
      "id": "exec_abc123",
      "user_message": "ê²°ì œ ëª¨ë“ˆ íƒ€ì„ì•„ì›ƒ ì„¤ì • ë°©ë²•",
      "response": "Spring WebClientì˜ timeout ì„¤ì •ì€...",
      "created_at": 1234567800
    }
  ],
  "conversation_count": 47,
  "context_bytes": 15234,
  "needs_summary": false
}
```

---

## ì»¨í…ìŠ¤íŠ¸ í™œìš© í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ê°œì¸í™”ëœ ì‘ë‹µ ìƒì„±                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ì‚¬ìš©ì ë©”ì‹œì§€          ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ           í”„ë¡¬í”„íŠ¸ êµ¬ì„±
       â”‚                     â”‚                      â”‚
       â–¼                     â–¼                      â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ "ì •ë ¬   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚Get Contextâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Build    â”‚
  â”‚ì•Œê³ ë¦¬ì¦˜"â”‚          â”‚           â”‚          â”‚  Prompt   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ System: {project.system_prompt}   â”‚
                            â”‚ User Rules: í•œêµ­ì–´, TypeScript    â”‚
                            â”‚ Context: Backend ê°œë°œì, Kotlin   â”‚
                            â”‚ Message: ì •ë ¬ ì•Œê³ ë¦¬ì¦˜ ì„¤ëª…í•´ì¤˜     â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚  Claude   â”‚
                                              â”‚   Code    â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì£¼ìš” ê¸°ëŠ¥

### 1. ì‚¬ìš©ì ê·œì¹™ (Rules)

ì‚¬ìš©ìê°€ ì§ì ‘ ì„¤ì •í•˜ëŠ” ì„ í˜¸ë„:

```bash
# ê·œì¹™ ì¶”ê°€
curl -X POST http://localhost:17280/v1/users/U123/rules \
  -H "Content-Type: application/json" \
  -d '{"rule": "í•­ìƒ ì½”ë“œì— ì£¼ì„ì„ ë‹¬ì•„ì¤˜"}'

# ê·œì¹™ ì¡°íšŒ
curl http://localhost:17280/v1/users/U123/rules

# ê·œì¹™ ì‚­ì œ
curl -X DELETE http://localhost:17280/v1/users/U123/rules \
  -d '{"rule": "í•­ìƒ ì½”ë“œì— ì£¼ì„ì„ ë‹¬ì•„ì¤˜"}'
```

**ê·œì¹™ ì˜ˆì‹œ**:
- "í•œêµ­ì–´ë¡œ ë‹µë³€í•´ì¤˜"
- "ì½”ë“œëŠ” Pythonìœ¼ë¡œ ì‘ì„±í•´ì¤˜"
- "ì„¤ëª… ì—†ì´ ì½”ë“œë§Œ ë³´ì—¬ì¤˜"
- "ì´ˆë³´ìì—ê²Œ ì„¤ëª…í•˜ë“¯ì´ í•´ì¤˜"

### 2. ëŒ€í™” ìš”ì•½ (Summary)

ì¥ê¸° ì»¨í…ìŠ¤íŠ¸ ìœ ì§€ë¥¼ ìœ„í•œ ìë™ ìš”ì•½:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ëŒ€í™” ìš”ì•½ í”„ë¡œì„¸ìŠ¤                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  recent_conversations (Nê°œ ì¶•ì )
            â”‚
            â–¼
    context_bytes > ì„ê³„ê°’?
            â”‚
       â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
       â–¼         â–¼
      No        Yes
       â”‚         â”‚
       â–¼         â–¼
    [ìœ ì§€]    [ìš”ì•½ íŠ¸ë¦¬ê±°]
                 â”‚
                 â–¼
         Claudeë¡œ ìš”ì•½ ìƒì„±
                 â”‚
                 â–¼
         summary ì—…ë°ì´íŠ¸
         recent_conversations ì´ˆê¸°í™”
```

**ìš”ì•½ ê²°ê³¼ ì˜ˆì‹œ**:
```
"Backend ê°œë°œì. Spring Boot, Kotlin ì „ë¬¸.
ì£¼ë¡œ ê²°ì œ ì‹œìŠ¤í…œ ê´€ë ¨ ì§ˆë¬¸. ì„±ëŠ¥ ìµœì í™”ì— ê´€ì‹¬.
ìµœê·¼ WebClient íƒ€ì„ì•„ì›ƒ, íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€ ë…¼ì˜."
```

### 3. ìµœê·¼ ëŒ€í™” (Recent Conversations)

ë‹¨ê¸° ì»¨í…ìŠ¤íŠ¸ ìœ ì§€:

```json
{
  "recent_conversations": [
    {
      "id": "exec_001",
      "user_message": "Spring WebClient íƒ€ì„ì•„ì›ƒ ì„¤ì •",
      "response": "WebClient.builder().clientConnector(...)",
      "created_at": 1234567800,
      "has_negative_feedback": false
    },
    {
      "id": "exec_002",
      "user_message": "ê·¸ëŸ¼ ì¬ì‹œë„ ë¡œì§ì€?",
      "response": "retryWhen(Retry.backoff(3, Duration.ofSeconds(1)))",
      "created_at": 1234567900,
      "has_negative_feedback": false
    }
  ]
}
```

---

## API

### ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ

```
GET /v1/users/{user_id}/context
```

**ì‘ë‹µ**:
```json
{
  "user_id": "U0123456789",
  "rules": ["í•œêµ­ì–´ë¡œ ë‹µë³€"],
  "summary": "Backend ê°œë°œì...",
  "recent_conversations": [...],
  "conversation_count": 47,
  "context_bytes": 15234,
  "needs_summary": false,
  "summary_locked": false
}
```

### ì»¨í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸

```
PUT /v1/users/{user_id}/context
```

**ìš”ì²­**:
```json
{
  "summary": "ìƒˆë¡œìš´ ìš”ì•½ ë‚´ìš©",
  "clear_conversations": true
}
```

### ê·œì¹™ ê´€ë¦¬

```
GET    /v1/users/{user_id}/rules          # ê·œì¹™ ëª©ë¡
POST   /v1/users/{user_id}/rules          # ê·œì¹™ ì¶”ê°€
DELETE /v1/users/{user_id}/rules          # ê·œì¹™ ì‚­ì œ
```

### ìš”ì•½ ì ê¸ˆ í•´ì œ

ë™ì‹œ ìš”ì•½ ë°©ì§€ë¥¼ ìœ„í•œ ì ê¸ˆ ê´€ë¦¬:

```
DELETE /v1/users/{user_id}/context/lock
```

---

## í”„ë¡¬í”„íŠ¸ ì£¼ì…

### slack-mention-handlerì—ì„œì˜ í™œìš©

```javascript
// ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ
const context = await fetch(`${API_URL}/v1/users/${user_id}/context`);

// í”„ë¡¬í”„íŠ¸ êµ¬ì„±
const prompt = `
## User Rules
${context.rules.map(r => `- ${r}`).join('\n')}

## User Context
${context.summary || 'No context available'}

## Recent Conversations
${context.recent_conversations.slice(-3).map(c =>
  `Q: ${c.user_message}\nA: ${c.response.slice(0, 200)}...`
).join('\n\n')}

## Current Question
${user_message}
`;
```

---

## ëŒ€ì‹œë³´ë“œ: Users í˜ì´ì§€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Users                                            Search ğŸ” â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  User             Rules  Conversations  Last Active         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  john.doe         3      47            2 hours ago          â”‚
â”‚  jane.smith       1      23            1 day ago            â”‚
â”‚  bob.wilson       5      156           30 minutes ago       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User: john.doe                                     Edit ğŸ“ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Rules:                                                     â”‚
â”‚  â€¢ í•­ìƒ í•œêµ­ì–´ë¡œ ë‹µë³€í•´ì¤˜                                    â”‚
â”‚  â€¢ ì½”ë“œ ì˜ˆì‹œëŠ” TypeScriptë¡œ ì‘ì„±í•´ì¤˜                         â”‚
â”‚  â€¢ ì„¤ëª…ì€ ê°„ê²°í•˜ê²Œ í•´ì¤˜                                      â”‚
â”‚                                                             â”‚
â”‚  Summary:                                                   â”‚
â”‚  Backend ê°œë°œì. Spring Boot, Kotlin ì „ë¬¸.                  â”‚
â”‚  ìµœê·¼ ê²°ì œ ì‹œìŠ¤í…œ ë¦¬íŒ©í† ë§ ì§„í–‰ ì¤‘.                          â”‚
â”‚                                                             â”‚
â”‚  Stats:                                                     â”‚
â”‚  â€¢ Total conversations: 47                                  â”‚
â”‚  â€¢ Context size: 15.2 KB                                    â”‚
â”‚  â€¢ Last summarized: 3 days ago                              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì—°ê´€ ì›Œí¬í”Œë¡œìš°

- [slack-mention-handler](slack-mention-handler.md) â€” ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ ë° í”„ë¡¬í”„íŠ¸ ì£¼ì…
- [slack-feedback-handler](slack-feedback-handler.md) â€” ë¶€ì • í”¼ë“œë°± ì‹œ ì»¨í…ìŠ¤íŠ¸ ë°˜ì˜
